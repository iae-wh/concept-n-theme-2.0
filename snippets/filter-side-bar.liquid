<script src="{{ 'price-range.js' | asset_url }}" defer="defer"></script>
<form id="filter-form" class="text-black">
    <div class="accordion accordion-flush" id="filter-wrapper">
        {%- for filter in filters -%}
            {% assign index = forloop.index %}
            <div
                class="accordion-item filter-item"
                data-filter-type="{{ filter.type }}"
                {%- if filter.type == "price_range" -%}
                    data-min-price="{{ filter.min_value.value }}"
                    data-max-price="{{ filter.max_value.value }}"
                {% endif %}
            >
                <h2 class="accordion-header text-black">
                    <button
                        class="filter-heading ps-0 pe-0 pt-3 pb-3 bg-white accordion-button collapsed shadow-none fs-7"
                        type="button" data-bs-toggle="collapse" data-bs-target="#filter-item-{{ index }}"
                        aria-expanded="false" aria-controls="filter-item-{{ index }}"
                    >
                        <span class="me-1">{{ filter.label }}</span>
                        {%- if filter.active_values.size > 0 -%}
                            <span>({{ filter.active_values.size }})</span>
                        {%- endif -%}
                    </button>
                </h2>
                <div id="filter-item-{{ index }}" class="accordion-collapse collapse bg-white text-black fs-7 pb-2">
                     {% comment %}data-bs-parent="#filter-wrapper">{% endcomment %}
                    <div class="accordion-body pt-1 pb-1 ps-0 pe-0">
                        <div>
                            {%- case filter.type -%}
                                {%- when 'boolean' -%}
                                    <p class="mb-2">
                                        <label class="d-flex align-items-center {% if filter_value.count == 0 and filter_value.active == false -%}disabled{%- endif %}">
                                            <input
                                                type="checkbox"
                                                name="{{ filter.param_name }}"
                                                value="{{ filter.true_value.value }}"
                                                id="Filter-{{ filter.param_name }}"
                                                {% if filter.true_value.active -%}checked{%- endif %}
                                                {% if filter.true_value.count == 0 and filter.true_value.active == false -%}disabled{%- endif -%}
                                            >
                                            {% if filter.true_value.label != blank %}
                                                {{ filter.true_value.label }}
                                            {% else %}
                                                Yes
                                            {% endif %}
                                        </label>
                                    </p>
                                    <p class="mb-2">
                                        <label class="d-flex align-items-center {% if filter_value.count == 0 and filter_value.active == false -%}disabled{%- endif %}">
                                            <input
                                                type="checkbox"
                                                name="{{ filter.param_name }}"
                                                value="{{ filter.false_value.value }}"
                                                id="Filter-{{ filter.param_name }}"
                                                {% if filter.false_value.active -%}checked{%- endif %}
                                                {% if filter.false_value.count == 0 and filter.false_value.active == false -%}disabled{%- endif %}
                                            >
                                            {% if filter.false_value.label != blank %}
                                                {{ filter.false_value.label }}
                                            {% else %}
                                                No
                                            {% endif %}
                                        </label>
                                    </p>
                                {%- when 'list' -%}
                                    {%- for filter_value in filter.values -%}
                                        <p class="mb-2">
                                            <label class="d-flex align-items-center {% if filter_value.count == 0 and filter_value.active == false -%}disabled{%- endif %}">
                                                <input
                                                    type="checkbox"
                                                    name="{{ filter_value.param_name }}"
                                                    value="{{ filter_value.value }}"
                                                    id="Filter-{{ filter.param_name }}-{{ forloop.index }}"
                                                    {% if filter_value.active -%}checked{%- endif %}
                                                    {% if filter_value.count == 0 and filter_value.active == false -%}disabled{%- endif %}
                                                >
                                                <span>
                                                    {%- case filter_value.display.type -%}
                                                        {%- when 'colors' -%}
                                                            {% liquid
                                                                assign size_limit = filter_value.display.value.size | at_most: 4
                                                                assign rotation = '0deg'
                                                                if size_limit == 2
                                                                    assign rotation = '45deg'
                                                                endif

                                                                assign angle_increment = 360 | divided_by: size_limit
                                                                assign angle = 0
                                                            %}
                                                            {%- capture conic_gradient -%}
                                                                {%- for color in filter_value.display.value limit: size_limit -%}
                                                                    {{ color }} {{ angle }}deg{%- assign angle = angle | plus: angle_increment %} {{ angle }}deg{%- unless forloop.last %}, {%- endunless -%}
                                                                {%- endfor -%}
                                                            {%- endcapture -%}
                                                            <span
                                                                style="
                                                                    width: 25px;
                                                                    height: 25px;
                                                                    border-radius: 50%;
                                                                    display: flex;
                                                                    justify-content: center;
                                                                    align-items: center;
                                                                    background: conic-gradient({{ conic_gradient }});
                                                                    transform: rotateZ({{ rotation }});
                                                                    "></span>
                                                        {%- when 'image' -%}
                                                            {{
                                                            filter_value.display.value
                                                            | image_url: width: 25
                                                            | image_tag: alt: filter_value.display.value.alt
                                                            }}
                                                        {%- else -%}
                                                            <span class="visual-display__child"></span>
                                                    {%- endcase -%}
                                                    </span>
                                                {{ filter_value.label }}
                                            </label>
                                        </p>
                                    {%- endfor -%}
                                {%- when 'price_range' -%}
                                    <div class="d-flex align-items-center justify-content-between column-gap-3">
                                        {% render 'price-range', filter: filter, id_prefix: 'Filter' %}
                                    </div>
                            {%- endcase -%}
                        </div>
                    </div>
                </div>
            </div>
        {%- endfor -%}
    </div>

    <div class="d-flex gap-2 flex-wrap fs-7">
        {%- for filter in filters -%}
            {%- if filter.type == "price_range" -%}
                {%- if filter.min_value.value != nil or filter.max_value.value != nil -%}
                    <p class="mb-0 current-filter">
                        <a href="{{ filter.url_to_remove }}">
                            {%- assign min_value = filter.min_value.value | default: 0 -%}
                            {%- assign max_value = filter.max_value.value | default: filter.range_max -%}
                            {{ min_value | money }} - {{ max_value | money }} X
                        </a>
                    </p>
                {%- endif -%}
            {%- else -%}
                {%- for filter_value in filter.active_values -%}
                    <p class="mb-0 current-filter">
                        <a href="{{ filter_value.url_to_remove }}">
                            {{ filter.label }}: {{ filter_value.label }} x
                        </a>
                    </p>
                {%- endfor -%}
            {%- endif -%}
        {%- endfor -%}
    </div>
</form>
